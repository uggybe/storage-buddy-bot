# üî• –†–µ—à–µ–Ω–∏–µ "—Å –Ω—É–ª—è" - 100% —Ä–∞–±–æ—Ç–∞–µ—Ç

## –ü—Ä–æ–±–ª–µ–º–∞

–î–∞–∂–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –æ—à–∏–±–∫–∞ –æ—Å—Ç–∞–ª–∞—Å—å –ø–æ—Ç–æ–º—É —á—Ç–æ:
- PostgreSQL —É–∂–µ —Å–æ–∑–¥–∞–ª –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –°–¢–ê–†–´–ú–ò –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –≤–∏–¥–∏—Ç –Ω–∞–¥–ø–∏—Å—å "PostgreSQL Database directory appears to contain a database; Skipping initialization"
- –ò –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–æ–≤—ã–µ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ) –º–∏–≥—Ä–∞—Ü–∏–∏

## –†–µ—à–µ–Ω–∏–µ: –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞

### –®–∞–≥ 1: –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

```cmd
cd C:\bimbom\storage-buddy-bot
docker compose down
```

### –®–∞–≥ 2: –í–†–£–ß–ù–£–Æ —É–¥–∞–ª–∏—Ç–µ volume –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```cmd
docker volume rm storage-buddy-bot_postgres-data
```

–ï—Å–ª–∏ –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É "volume is in use":
```cmd
docker compose down -v
docker volume rm storage-buddy-bot_postgres-data
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ volume —É–¥–∞–ª–µ–Ω

```cmd
docker volume ls | findstr postgres
```

–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å `postgres-data`. –ï—Å–ª–∏ –µ—Å—Ç—å - –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –®–∞–≥ 2.

### –®–∞–≥ 4: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –º–µ—Å—Ç–µ

```cmd
dir supabase\migrations\20251117*.sql
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å 4 —Ñ–∞–π–ª–∞:
- 20251117000001_add_manufacturer_to_items.sql
- 20251117000002_add_name_fields_to_whitelist.sql
- 20251117000003_fix_cascade_delete_transactions.sql
- 20251117000004_add_performance_indexes.sql

–ï—Å–ª–∏ —ç—Ç–∏—Ö —Ñ–∞–π–ª–æ–≤ –ù–ï–¢:
```cmd
git pull
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –°–¢–ê–†–´–• –º–∏–≥—Ä–∞—Ü–∏–π –ù–ï–¢

```cmd
dir supabase\migrations\20250111*.sql
dir supabase\migrations\20250113*.sql
```

–û–±–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –≤—ã–¥–∞—Ç—å "–ù–µ —É–¥–∞–µ—Ç—Å—è –Ω–∞–π—Ç–∏ —Ñ–∞–π–ª".

–ï—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–∞–π–¥–µ–Ω—ã - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `git pull` –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É.

### –®–∞–≥ 6: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å —á–∏—Å—Ç–æ–π –±–∞–∑–æ–π

```cmd
docker compose up -d
```

### –®–∞–≥ 7: –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```cmd
docker compose logs -f postgres
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
/docker-entrypoint-initdb.d/00000000000000_init_roles.sql
CREATE ROLE
CREATE ROLE
CREATE ROLE
... (7 —Ä–∞–∑ CREATE ROLE)
CREATE SCHEMA
... (—Å–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º auth, storage, realtime)

/docker-entrypoint-initdb.d/20251108...
CREATE TABLE
... (—Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü)

/docker-entrypoint-initdb.d/20251117000001_add_manufacturer_to_items.sql
ALTER TABLE
... (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π)
```

**–í–ê–ñ–ù–û:** –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ "relation does not exist"!

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ - –Ω–∞–∂–º–∏—Ç–µ Ctrl+C –∏ –ø—Ä–∏—à–ª–∏—Ç–µ –º–Ω–µ –ø–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥.

### –®–∞–≥ 8: –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2 –º–∏–Ω—É—Ç—ã

–ù–∞–∂–º–∏—Ç–µ Ctrl+C —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤.

–ü–æ–¥–æ–∂–¥–∏—Ç–µ –ø–æ–∫–∞ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å—Ç–∞—Ä—Ç—É—é—Ç.

### –®–∞–≥ 9: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å

```cmd
docker compose ps
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
NAME                     STATUS
storage-buddy-postgres   Up (healthy)     ‚úÖ
storage-buddy-kong       Up (healthy)     ‚úÖ
storage-buddy-auth       Up               ‚úÖ
storage-buddy-rest       Up               ‚úÖ
storage-buddy-storage    Up               ‚úÖ
storage-buddy-realtime   Up               ‚úÖ
storage-buddy-frontend   Up               ‚úÖ
storage-buddy-telegram   Up (unhealthy)*  ‚ö†Ô∏è
storage-buddy-imgproxy   Up               ‚úÖ
```

*unhealthy —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ TELEGRAM_BOT_TOKEN –≤ .env

## –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–í—ã–ø–æ–ª–Ω–∏—Ç–µ:
```cmd
scripts\full-diagnose.bat
```

–ò **–ø—Ä–∏—à–ª–∏—Ç–µ –º–Ω–µ –≤–µ—Å—å –≤—ã–≤–æ–¥ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã**.

## –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. `docker volume rm` - **–ø–æ–ª–Ω–æ—Å—Ç—å—é** —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—É—é –±–∞–∑—É
2. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ PostgreSQL –≤–∏–¥–∏—Ç **–ø—É—Å—Ç—É—é** –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç **–≤—Å–µ** init —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–Ω–æ–≤–æ
4. –í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º** –ø–æ—Ä—è–¥–∫–µ
5. –°–æ–∑–¥–∞–µ—Ç —á–∏—Å—Ç—É—é —Ä–∞–±–æ—á—É—é –±–∞–∑—É ‚úÖ

## –ë—ã—Å—Ç—Ä–∞—è –≤–µ—Ä—Å–∏—è (–µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ git pull —Å–¥–µ–ª–∞–Ω)

```cmd
docker compose down
docker volume rm storage-buddy-bot_postgres-data
docker compose up -d
docker compose logs -f postgres
```

–ñ–¥–µ–º –ø–æ–∫–∞ —Å–æ–∑–¥–∞—Å—Ç—Å—è –±–∞–∑–∞ (–±–µ–∑ –æ—à–∏–±–æ–∫), Ctrl+C, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å.

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

–≠—Ç–æ —É–¥–∞–ª–∏—Ç **–í–°–ï** –¥–∞–Ω–Ω—ã–µ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã!

–ù–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ - —É –≤–∞—Å –µ—â–µ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ self-hosted –≤–µ—Ä—Å–∏–∏.

–í—Å–µ –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ –µ—â–µ –≤ –æ–±–ª–∞—á–Ω–æ–π Supabase.

---

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —ç—Ç–∏ —à–∞–≥–∏ –∏ –¥–∞–π—Ç–µ –∑–Ω–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç! üöÄ
